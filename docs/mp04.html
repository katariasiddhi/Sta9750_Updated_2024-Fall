<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Siddhi Kataria">

<title>Monte Carlo-Informed Selection of CUNY Retirement Plans – STA 9750 2024 Updated Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-71a306e5adce98516e0bef91e99219f9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Updated Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Monte Carlo-Informed Selection of CUNY Retirement Plans</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Siddhi Kataria </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The objective of this project is to analyze and compare two retirement plans offered by CUNY using Monte Carlo simulations. By leveraging historical financial data, bootstrap resampling, and Monte Carlo techniques, we aim to assess the likelihood that one plan outperforms the other under various market conditions. This analysis will consider factors like historical market returns, inflation rates, and individual demographics to provide a data-driven recommendation for optimal retirement planning.</p>
<p>The analysis is implemented in R using RStudio, taking advantage of packages such as tidyverse, boot, and quantmod for data manipulation, statistical computation, and financial data acquisition. This comprehensive approach ensures robust and replicable results.</p>
<section id="data-retrieval" class="level2">
<h2 class="anchored" data-anchor-id="data-retrieval">Data Retrieval</h2>
<section id="load-api-keys" class="level3">
<h3 class="anchored" data-anchor-id="load-api-keys">Load API keys</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Accessing the keys</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>alpha_key <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"ALPHAVANTAGE_KEY"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>fred_key <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"FRED_KEY"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="alphavantage-example-get-stock-data" class="level3">
<h3 class="anchored" data-anchor-id="alphavantage-example-get-stock-data">AlphaVantage Example: Get stock data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>alpha_url <span class="ot">&lt;-</span> <span class="st">"https://www.alphavantage.co/query"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_DAILY_ADJUSTED"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">symbol =</span> <span class="st">"AAPL"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">apikey =</span> alpha_key</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(alpha_url, <span class="at">query =</span> params)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>alpha_data <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">content</span>(response, <span class="at">as =</span> <span class="st">"parsed"</span>, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="parse-alphavantage-data" class="level3">
<h3 class="anchored" data-anchor-id="parse-alphavantage-data">Parse AlphaVantage Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.3.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse AlphaVantage Data</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>stock_data <span class="ot">&lt;-</span> alpha_data[[<span class="st">"Time Series (Daily)"</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"Date"</span>, <span class="at">value =</span> <span class="st">"Metrics"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest_wider</span>(Metrics) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse AlphaVantage Data</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>stock_data <span class="ot">&lt;-</span> alpha_data[[<span class="st">"Time Series (Daily)"</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"Date"</span>, <span class="at">value =</span> <span class="st">"Metrics"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest_wider</span>(Metrics) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example API request to fetch data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"https://www.alphavantage.co/query"</span>, <span class="at">query =</span> <span class="fu">list</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">'function'</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_DAILY"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">symbol =</span> <span class="st">"SP500"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">apikey =</span> <span class="st">"your_api_key"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the content of the response</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>sp500_data <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"parsed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>params_sp500 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_DAILY"</span>,  <span class="co"># Use the free endpoint</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">symbol =</span> <span class="st">"SPY"</span>,                   <span class="co"># Ticker symbol for SPDR S&amp;P 500 ETF</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">apikey =</span> alpha_key</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>response_sp500 <span class="ot">&lt;-</span> <span class="fu">GET</span>(alpha_url, <span class="at">query =</span> params_sp500)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>sp500_data <span class="ot">&lt;-</span> <span class="fu">content</span>(response_sp500, <span class="at">as =</span> <span class="st">"parsed"</span>, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect response structure</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sp500_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ Meta Data          :List of 5
  ..$ 1. Information   : chr "Daily Prices (open, high, low, close) and Volumes"
  ..$ 2. Symbol        : chr "SPY"
  ..$ 3. Last Refreshed: chr "2024-12-10"
  ..$ 4. Output Size   : chr "Compact"
  ..$ 5. Time Zone     : chr "US/Eastern"
 $ Time Series (Daily):List of 100
  ..$ 2024-12-10:List of 5
  .. ..$ 1. open  : chr "605.3700"
  .. ..$ 2. high  : chr "605.8000"
  .. ..$ 3. low   : chr "602.1300"
  .. ..$ 4. close : chr "602.8000"
  .. ..$ 5. volume: chr "37234515"
  ..$ 2024-12-09:List of 5
  .. ..$ 1. open  : chr "607.6900"
  .. ..$ 2. high  : chr "607.8600"
  .. ..$ 3. low   : chr "604.0800"
  .. ..$ 4. close : chr "604.6800"
  .. ..$ 5. volume: chr "34742738"
  ..$ 2024-12-06:List of 5
  .. ..$ 1. open  : chr "607.4400"
  .. ..$ 2. high  : chr "609.0700"
  .. ..$ 3. low   : chr "607.0200"
  .. ..$ 4. close : chr "607.8100"
  .. ..$ 5. volume: chr "31241549"
  ..$ 2024-12-05:List of 5
  .. ..$ 1. open  : chr "607.6600"
  .. ..$ 2. high  : chr "608.4800"
  .. ..$ 3. low   : chr "606.3050"
  .. ..$ 4. close : chr "606.6600"
  .. ..$ 5. volume: chr "28762183"
  ..$ 2024-12-04:List of 5
  .. ..$ 1. open  : chr "605.6300"
  .. ..$ 2. high  : chr "607.9100"
  .. ..$ 3. low   : chr "604.9500"
  .. ..$ 4. close : chr "607.6600"
  .. ..$ 5. volume: chr "42787561"
  ..$ 2024-12-03:List of 5
  .. ..$ 1. open  : chr "603.3900"
  .. ..$ 2. high  : chr "604.1600"
  .. ..$ 3. low   : chr "602.3410"
  .. ..$ 4. close : chr "603.9100"
  .. ..$ 5. volume: chr "26906629"
  ..$ 2024-12-02:List of 5
  .. ..$ 1. open  : chr "602.9700"
  .. ..$ 2. high  : chr "604.3200"
  .. ..$ 3. low   : chr "602.4700"
  .. ..$ 4. close : chr "603.6300"
  .. ..$ 5. volume: chr "31745989"
  ..$ 2024-11-29:List of 5
  .. ..$ 1. open  : chr "599.6600"
  .. ..$ 2. high  : chr "603.3500"
  .. ..$ 3. low   : chr "599.3800"
  .. ..$ 4. close : chr "602.5500"
  .. ..$ 5. volume: chr "30095740"
  ..$ 2024-11-27:List of 5
  .. ..$ 1. open  : chr "600.4600"
  .. ..$ 2. high  : chr "600.8500"
  .. ..$ 3. low   : chr "597.2800"
  .. ..$ 4. close : chr "598.8300"
  .. ..$ 5. volume: chr "34000163"
  ..$ 2024-11-26:List of 5
  .. ..$ 1. open  : chr "598.8000"
  .. ..$ 2. high  : chr "601.3300"
  .. ..$ 3. low   : chr "598.0700"
  .. ..$ 4. close : chr "600.6500"
  .. ..$ 5. volume: chr "45621288"
  ..$ 2024-11-25:List of 5
  .. ..$ 1. open  : chr "599.5200"
  .. ..$ 2. high  : chr "600.8600"
  .. ..$ 3. low   : chr "595.2000"
  .. ..$ 4. close : chr "597.5300"
  .. ..$ 5. volume: chr "42441393"
  ..$ 2024-11-22:List of 5
  .. ..$ 1. open  : chr "593.6600"
  .. ..$ 2. high  : chr "596.1500"
  .. ..$ 3. low   : chr "593.1525"
  .. ..$ 4. close : chr "595.5100"
  .. ..$ 5. volume: chr "38226390"
  ..$ 2024-11-21:List of 5
  .. ..$ 1. open  : chr "593.4000"
  .. ..$ 2. high  : chr "595.1200"
  .. ..$ 3. low   : chr "587.4500"
  .. ..$ 4. close : chr "593.6700"
  .. ..$ 5. volume: chr "46750285"
  ..$ 2024-11-20:List of 5
  .. ..$ 1. open  : chr "590.3800"
  .. ..$ 2. high  : chr "590.7900"
  .. ..$ 3. low   : chr "584.6300"
  .. ..$ 4. close : chr "590.5000"
  .. ..$ 5. volume: chr "50032576"
  ..$ 2024-11-19:List of 5
  .. ..$ 1. open  : chr "584.7100"
  .. ..$ 2. high  : chr "591.0450"
  .. ..$ 3. low   : chr "584.0300"
  .. ..$ 4. close : chr "590.3000"
  .. ..$ 5. volume: chr "49412046"
  ..$ 2024-11-18:List of 5
  .. ..$ 1. open  : chr "586.2200"
  .. ..$ 2. high  : chr "589.4900"
  .. ..$ 3. low   : chr "585.3400"
  .. ..$ 4. close : chr "588.1500"
  .. ..$ 5. volume: chr "37084081"
  ..$ 2024-11-15:List of 5
  .. ..$ 1. open  : chr "589.7200"
  .. ..$ 2. high  : chr "590.2000"
  .. ..$ 3. low   : chr "583.8600"
  .. ..$ 4. close : chr "585.7500"
  .. ..$ 5. volume: chr "75988766"
  ..$ 2024-11-14:List of 5
  .. ..$ 1. open  : chr "597.3200"
  .. ..$ 2. high  : chr "597.8100"
  .. ..$ 3. low   : chr "592.6500"
  .. ..$ 4. close : chr "593.3500"
  .. ..$ 5. volume: chr "38904109"
  ..$ 2024-11-13:List of 5
  .. ..$ 1. open  : chr "597.3700"
  .. ..$ 2. high  : chr "599.2300"
  .. ..$ 3. low   : chr "594.9600"
  .. ..$ 4. close : chr "597.1900"
  .. ..$ 5. volume: chr "47388640"
  ..$ 2024-11-12:List of 5
  .. ..$ 1. open  : chr "598.6800"
  .. ..$ 2. high  : chr "599.2900"
  .. ..$ 3. low   : chr "594.3700"
  .. ..$ 4. close : chr "596.9000"
  .. ..$ 5. volume: chr "43006128"
  ..$ 2024-11-11:List of 5
  .. ..$ 1. open  : chr "599.8100"
  .. ..$ 2. high  : chr "600.1700"
  .. ..$ 3. low   : chr "597.0000"
  .. ..$ 4. close : chr "598.7600"
  .. ..$ 5. volume: chr "37586773"
  ..$ 2024-11-08:List of 5
  .. ..$ 1. open  : chr "596.1700"
  .. ..$ 2. high  : chr "599.6400"
  .. ..$ 3. low   : chr "596.1650"
  .. ..$ 4. close : chr "598.1900"
  .. ..$ 5. volume: chr "46444893"
  ..$ 2024-11-07:List of 5
  .. ..$ 1. open  : chr "593.0800"
  .. ..$ 2. high  : chr "596.6500"
  .. ..$ 3. low   : chr "592.9999"
  .. ..$ 4. close : chr "595.6100"
  .. ..$ 5. volume: chr "47233212"
  ..$ 2024-11-06:List of 5
  .. ..$ 1. open  : chr "589.2000"
  .. ..$ 2. high  : chr "591.9300"
  .. ..$ 3. low   : chr "585.3900"
  .. ..$ 4. close : chr "591.0400"
  .. ..$ 5. volume: chr "68181968"
  ..$ 2024-11-05:List of 5
  .. ..$ 1. open  : chr "570.7400"
  .. ..$ 2. high  : chr "576.7400"
  .. ..$ 3. low   : chr "570.5200"
  .. ..$ 4. close : chr "576.7000"
  .. ..$ 5. volume: chr "39478322"
  ..$ 2024-11-04:List of 5
  .. ..$ 1. open  : chr "571.1800"
  .. ..$ 2. high  : chr "572.5000"
  .. ..$ 3. low   : chr "567.8900"
  .. ..$ 4. close : chr "569.8100"
  .. ..$ 5. volume: chr "38216975"
  ..$ 2024-11-01:List of 5
  .. ..$ 1. open  : chr "571.3200"
  .. ..$ 2. high  : chr "575.5500"
  .. ..$ 3. low   : chr "570.6200"
  .. ..$ 4. close : chr "571.0400"
  .. ..$ 5. volume: chr "45667533"
  ..$ 2024-10-31:List of 5
  .. ..$ 1. open  : chr "575.5600"
  .. ..$ 2. high  : chr "575.6300"
  .. ..$ 3. low   : chr "568.4400"
  .. ..$ 4. close : chr "568.6400"
  .. ..$ 5. volume: chr "60182451"
  ..$ 2024-10-30:List of 5
  .. ..$ 1. open  : chr "581.2900"
  .. ..$ 2. high  : chr "583.3200"
  .. ..$ 3. low   : chr "579.2900"
  .. ..$ 4. close : chr "580.0100"
  .. ..$ 5. volume: chr "41435839"
  ..$ 2024-10-29:List of 5
  .. ..$ 1. open  : chr "579.8500"
  .. ..$ 2. high  : chr "582.9070"
  .. ..$ 3. low   : chr "578.4300"
  .. ..$ 4. close : chr "581.7700"
  .. ..$ 5. volume: chr "42899661"
  ..$ 2024-10-28:List of 5
  .. ..$ 1. open  : chr "582.5800"
  .. ..$ 2. high  : chr "582.7100"
  .. ..$ 3. low   : chr "580.5200"
  .. ..$ 4. close : chr "580.8300"
  .. ..$ 5. volume: chr "30174704"
  ..$ 2024-10-25:List of 5
  .. ..$ 1. open  : chr "581.5100"
  .. ..$ 2. high  : chr "584.4600"
  .. ..$ 3. low   : chr "578.0800"
  .. ..$ 4. close : chr "579.0400"
  .. ..$ 5. volume: chr "47268176"
  ..$ 2024-10-24:List of 5
  .. ..$ 1. open  : chr "579.9800"
  .. ..$ 2. high  : chr "580.0600"
  .. ..$ 3. low   : chr "576.5700"
  .. ..$ 4. close : chr "579.2400"
  .. ..$ 5. volume: chr "34979860"
  ..$ 2024-10-23:List of 5
  .. ..$ 1. open  : chr "581.2600"
  .. ..$ 2. high  : chr "581.7086"
  .. ..$ 3. low   : chr "574.4150"
  .. ..$ 4. close : chr "577.9900"
  .. ..$ 5. volume: chr "49314574"
  ..$ 2024-10-22:List of 5
  .. ..$ 1. open  : chr "581.0500"
  .. ..$ 2. high  : chr "584.5000"
  .. ..$ 3. low   : chr "580.3800"
  .. ..$ 4. close : chr "583.3200"
  .. ..$ 5. volume: chr "34183835"
  ..$ 2024-10-21:List of 5
  .. ..$ 1. open  : chr "583.8500"
  .. ..$ 2. high  : chr "584.8500"
  .. ..$ 3. low   : chr "580.6001"
  .. ..$ 4. close : chr "583.6300"
  .. ..$ 5. volume: chr "36439010"
  ..$ 2024-10-18:List of 5
  .. ..$ 1. open  : chr "584.0700"
  .. ..$ 2. high  : chr "585.3900"
  .. ..$ 3. low   : chr "582.5800"
  .. ..$ 4. close : chr "584.5900"
  .. ..$ 5. volume: chr "37416801"
  ..$ 2024-10-17:List of 5
  .. ..$ 1. open  : chr "585.9100"
  .. ..$ 2. high  : chr "586.1200"
  .. ..$ 3. low   : chr "582.1600"
  .. ..$ 4. close : chr "582.3500"
  .. ..$ 5. volume: chr "34393714"
  ..$ 2024-10-16:List of 5
  .. ..$ 1. open  : chr "579.7800"
  .. ..$ 2. high  : chr "582.8300"
  .. ..$ 3. low   : chr "578.9600"
  .. ..$ 4. close : chr "582.3000"
  .. ..$ 5. volume: chr "30725436"
  ..$ 2024-10-15:List of 5
  .. ..$ 1. open  : chr "584.5900"
  .. ..$ 2. high  : chr "584.9000"
  .. ..$ 3. low   : chr "578.5450"
  .. ..$ 4. close : chr "579.7800"
  .. ..$ 5. volume: chr "54203636"
  ..$ 2024-10-14:List of 5
  .. ..$ 1. open  : chr "581.2200"
  .. ..$ 2. high  : chr "585.2700"
  .. ..$ 3. low   : chr "580.7300"
  .. ..$ 4. close : chr "584.3200"
  .. ..$ 5. volume: chr "36217215"
  ..$ 2024-10-11:List of 5
  .. ..$ 1. open  : chr "576.0500"
  .. ..$ 2. high  : chr "580.3300"
  .. ..$ 3. low   : chr "575.9100"
  .. ..$ 4. close : chr "579.5800"
  .. ..$ 5. volume: chr "42267994"
  ..$ 2024-10-10:List of 5
  .. ..$ 1. open  : chr "575.7700"
  .. ..$ 2. high  : chr "577.5800"
  .. ..$ 3. low   : chr "574.4900"
  .. ..$ 4. close : chr "576.1300"
  .. ..$ 5. volume: chr "44138060"
  ..$ 2024-10-09:List of 5
  .. ..$ 1. open  : chr "573.1600"
  .. ..$ 2. high  : chr "577.7100"
  .. ..$ 3. low   : chr "572.5500"
  .. ..$ 4. close : chr "577.1400"
  .. ..$ 5. volume: chr "37912244"
  ..$ 2024-10-08:List of 5
  .. ..$ 1. open  : chr "570.4200"
  .. ..$ 2. high  : chr "573.7800"
  .. ..$ 3. low   : chr "569.5299"
  .. ..$ 4. close : chr "573.1700"
  .. ..$ 5. volume: chr "37398693"
  ..$ 2024-10-07:List of 5
  .. ..$ 1. open  : chr "571.3000"
  .. ..$ 2. high  : chr "571.9599"
  .. ..$ 3. low   : chr "566.6300"
  .. ..$ 4. close : chr "567.8000"
  .. ..$ 5. volume: chr "49964690"
  ..$ 2024-10-04:List of 5
  .. ..$ 1. open  : chr "572.3500"
  .. ..$ 2. high  : chr "573.3600"
  .. ..$ 3. low   : chr "568.1000"
  .. ..$ 4. close : chr "572.9800"
  .. ..$ 5. volume: chr "43005186"
  ..$ 2024-10-03:List of 5
  .. ..$ 1. open  : chr "567.3600"
  .. ..$ 2. high  : chr "569.8025"
  .. ..$ 3. low   : chr "565.4900"
  .. ..$ 4. close : chr "567.8200"
  .. ..$ 5. volume: chr "40846466"
  ..$ 2024-10-02:List of 5
  .. ..$ 1. open  : chr "567.7100"
  .. ..$ 2. high  : chr "569.9000"
  .. ..$ 3. low   : chr "565.2700"
  .. ..$ 4. close : chr "568.8600"
  .. ..$ 5. volume: chr "38097798"
  ..$ 2024-10-01:List of 5
  .. ..$ 1. open  : chr "573.4000"
  .. ..$ 2. high  : chr "574.0622"
  .. ..$ 3. low   : chr "566.0000"
  .. ..$ 4. close : chr "568.6200"
  .. ..$ 5. volume: chr "72668778"
  ..$ 2024-09-30:List of 5
  .. ..$ 1. open  : chr "570.4200"
  .. ..$ 2. high  : chr "574.3800"
  .. ..$ 3. low   : chr "568.0800"
  .. ..$ 4. close : chr "573.7600"
  .. ..$ 5. volume: chr "63655448"
  ..$ 2024-09-27:List of 5
  .. ..$ 1. open  : chr "573.3900"
  .. ..$ 2. high  : chr "574.2200"
  .. ..$ 3. low   : chr "570.4200"
  .. ..$ 4. close : chr "571.4700"
  .. ..$ 5. volume: chr "42100928"
  ..$ 2024-09-26:List of 5
  .. ..$ 1. open  : chr "574.3800"
  .. ..$ 2. high  : chr "574.7100"
  .. ..$ 3. low   : chr "569.9000"
  .. ..$ 4. close : chr "572.3000"
  .. ..$ 5. volume: chr "48336004"
  ..$ 2024-09-25:List of 5
  .. ..$ 1. open  : chr "571.1400"
  .. ..$ 2. high  : chr "571.8900"
  .. ..$ 3. low   : chr "568.9100"
  .. ..$ 4. close : chr "570.0400"
  .. ..$ 5. volume: chr "38428587"
  ..$ 2024-09-24:List of 5
  .. ..$ 1. open  : chr "570.4800"
  .. ..$ 2. high  : chr "571.3600"
  .. ..$ 3. low   : chr "567.6000"
  .. ..$ 4. close : chr "571.3000"
  .. ..$ 5. volume: chr "46805672"
  ..$ 2024-09-23:List of 5
  .. ..$ 1. open  : chr "569.3400"
  .. ..$ 2. high  : chr "570.3325"
  .. ..$ 3. low   : chr "568.1000"
  .. ..$ 4. close : chr "569.6700"
  .. ..$ 5. volume: chr "44116922"
  ..$ 2024-09-20:List of 5
  .. ..$ 1. open  : chr "567.8400"
  .. ..$ 2. high  : chr "569.3100"
  .. ..$ 3. low   : chr "565.1700"
  .. ..$ 4. close : chr "568.2500"
  .. ..$ 5. volume: chr "77503110"
  ..$ 2024-09-19:List of 5
  .. ..$ 1. open  : chr "571.0100"
  .. ..$ 2. high  : chr "572.8800"
  .. ..$ 3. low   : chr "568.0800"
  .. ..$ 4. close : chr "570.9800"
  .. ..$ 5. volume: chr "75315470"
  ..$ 2024-09-18:List of 5
  .. ..$ 1. open  : chr "563.7400"
  .. ..$ 2. high  : chr "568.6900"
  .. ..$ 3. low   : chr "560.8300"
  .. ..$ 4. close : chr "561.4000"
  .. ..$ 5. volume: chr "59044937"
  ..$ 2024-09-17:List of 5
  .. ..$ 1. open  : chr "565.1000"
  .. ..$ 2. high  : chr "566.5800"
  .. ..$ 3. low   : chr "560.7950"
  .. ..$ 4. close : chr "563.0700"
  .. ..$ 5. volume: chr "49320970"
  ..$ 2024-09-16:List of 5
  .. ..$ 1. open  : chr "561.7400"
  .. ..$ 2. high  : chr "563.1100"
  .. ..$ 3. low   : chr "559.9000"
  .. ..$ 4. close : chr "562.8400"
  .. ..$ 5. volume: chr "36656122"
  ..$ 2024-09-13:List of 5
  .. ..$ 1. open  : chr "559.7100"
  .. ..$ 2. high  : chr "563.0300"
  .. ..$ 3. low   : chr "559.4500"
  .. ..$ 4. close : chr "562.0100"
  .. ..$ 5. volume: chr "39310501"
  ..$ 2024-09-12:List of 5
  .. ..$ 1. open  : chr "555.0100"
  .. ..$ 2. high  : chr "559.4000"
  .. ..$ 3. low   : chr "552.7400"
  .. ..$ 4. close : chr "559.0900"
  .. ..$ 5. volume: chr "51892735"
  ..$ 2024-09-11:List of 5
  .. ..$ 1. open  : chr "548.7000"
  .. ..$ 2. high  : chr "555.3600"
  .. ..$ 3. low   : chr "539.9600"
  .. ..$ 4. close : chr "554.4200"
  .. ..$ 5. volume: chr "75248608"
  ..$ 2024-09-10:List of 5
  .. ..$ 1. open  : chr "548.3600"
  .. ..$ 2. high  : chr "549.1500"
  .. ..$ 3. low   : chr "543.3800"
  .. ..$ 4. close : chr "548.7900"
  .. ..$ 5. volume: chr "36394579"
  ..$ 2024-09-09:List of 5
  .. ..$ 1. open  : chr "544.6500"
  .. ..$ 2. high  : chr "547.7100"
  .. ..$ 3. low   : chr "542.6800"
  .. ..$ 4. close : chr "546.4100"
  .. ..$ 5. volume: chr "40445822"
  ..$ 2024-09-06:List of 5
  .. ..$ 1. open  : chr "549.9400"
  .. ..$ 2. high  : chr "551.6000"
  .. ..$ 3. low   : chr "539.4400"
  .. ..$ 4. close : chr "540.3600"
  .. ..$ 5. volume: chr "68493805"
  ..$ 2024-09-05:List of 5
  .. ..$ 1. open  : chr "550.8900"
  .. ..$ 2. high  : chr "553.7995"
  .. ..$ 3. low   : chr "547.1000"
  .. ..$ 4. close : chr "549.6100"
  .. ..$ 5. volume: chr "44264258"
  ..$ 2024-09-04:List of 5
  .. ..$ 1. open  : chr "550.2000"
  .. ..$ 2. high  : chr "554.4300"
  .. ..$ 3. low   : chr "549.4600"
  .. ..$ 4. close : chr "550.9500"
  .. ..$ 5. volume: chr "46232483"
  ..$ 2024-09-03:List of 5
  .. ..$ 1. open  : chr "560.4700"
  .. ..$ 2. high  : chr "560.8100"
  .. ..$ 3. low   : chr "549.5100"
  .. ..$ 4. close : chr "552.0800"
  .. ..$ 5. volume: chr "60600113"
  ..$ 2024-08-30:List of 5
  .. ..$ 1. open  : chr "560.7700"
  .. ..$ 2. high  : chr "564.2000"
  .. ..$ 3. low   : chr "557.1400"
  .. ..$ 4. close : chr "563.6800"
  .. ..$ 5. volume: chr "62700110"
  ..$ 2024-08-29:List of 5
  .. ..$ 1. open  : chr "560.3100"
  .. ..$ 2. high  : chr "563.6800"
  .. ..$ 3. low   : chr "557.1800"
  .. ..$ 4. close : chr "558.3500"
  .. ..$ 5. volume: chr "38715176"
  ..$ 2024-08-28:List of 5
  .. ..$ 1. open  : chr "561.2100"
  .. ..$ 2. high  : chr "561.6500"
  .. ..$ 3. low   : chr "555.0400"
  .. ..$ 4. close : chr "558.3000"
  .. ..$ 5. volume: chr "41066024"
  ..$ 2024-08-27:List of 5
  .. ..$ 1. open  : chr "559.4900"
  .. ..$ 2. high  : chr "562.0600"
  .. ..$ 3. low   : chr "558.3200"
  .. ..$ 4. close : chr "561.5600"
  .. ..$ 5. volume: chr "32693898"
  ..$ 2024-08-26:List of 5
  .. ..$ 1. open  : chr "563.1800"
  .. ..$ 2. high  : chr "563.9100"
  .. ..$ 3. low   : chr "559.0500"
  .. ..$ 4. close : chr "560.7900"
  .. ..$ 5. volume: chr "35788609"
  ..$ 2024-08-23:List of 5
  .. ..$ 1. open  : chr "559.5300"
  .. ..$ 2. high  : chr "563.0900"
  .. ..$ 3. low   : chr "557.2900"
  .. ..$ 4. close : chr "562.1300"
  .. ..$ 5. volume: chr "50639393"
  ..$ 2024-08-22:List of 5
  .. ..$ 1. open  : chr "562.5600"
  .. ..$ 2. high  : chr "563.1800"
  .. ..$ 3. low   : chr "554.9800"
  .. ..$ 4. close : chr "556.2200"
  .. ..$ 5. volume: chr "56121456"
  ..$ 2024-08-21:List of 5
  .. ..$ 1. open  : chr "559.7700"
  .. ..$ 2. high  : chr "562.1100"
  .. ..$ 3. low   : chr "554.7300"
  .. ..$ 4. close : chr "560.6200"
  .. ..$ 5. volume: chr "41514600"
  ..$ 2024-08-20:List of 5
  .. ..$ 1. open  : chr "559.1500"
  .. ..$ 2. high  : chr "560.8400"
  .. ..$ 3. low   : chr "557.3250"
  .. ..$ 4. close : chr "558.7000"
  .. ..$ 5. volume: chr "33732264"
  ..$ 2024-08-19:List of 5
  .. ..$ 1. open  : chr "554.7300"
  .. ..$ 2. high  : chr "559.6100"
  .. ..$ 3. low   : chr "553.8600"
  .. ..$ 4. close : chr "559.6100"
  .. ..$ 5. volume: chr "39121793"
  ..$ 2024-08-16:List of 5
  .. ..$ 1. open  : chr "551.4200"
  .. ..$ 2. high  : chr "555.0200"
  .. ..$ 3. low   : chr "551.2600"
  .. ..$ 4. close : chr "554.3100"
  .. ..$ 5. volume: chr "44430728"
  ..$ 2024-08-15:List of 5
  .. ..$ 1. open  : chr "549.5000"
  .. ..$ 2. high  : chr "553.3600"
  .. ..$ 3. low   : chr "548.8800"
  .. ..$ 4. close : chr "553.0700"
  .. ..$ 5. volume: chr "60846812"
  ..$ 2024-08-14:List of 5
  .. ..$ 1. open  : chr "542.8500"
  .. ..$ 2. high  : chr "544.9600"
  .. ..$ 3. low   : chr "540.1200"
  .. ..$ 4. close : chr "543.7500"
  .. ..$ 5. volume: chr "42446929"
  ..$ 2024-08-13:List of 5
  .. ..$ 1. open  : chr "536.5300"
  .. ..$ 2. high  : chr "542.2800"
  .. ..$ 3. low   : chr "536.2800"
  .. ..$ 4. close : chr "542.0400"
  .. ..$ 5. volume: chr "52333073"
  ..$ 2024-08-12:List of 5
  .. ..$ 1. open  : chr "534.2100"
  .. ..$ 2. high  : chr "535.7300"
  .. ..$ 3. low   : chr "530.9500"
  .. ..$ 4. close : chr "533.2700"
  .. ..$ 5. volume: chr "42542069"
  ..$ 2024-08-09:List of 5
  .. ..$ 1. open  : chr "529.8100"
  .. ..$ 2. high  : chr "534.5100"
  .. ..$ 3. low   : chr "528.5600"
  .. ..$ 4. close : chr "532.9900"
  .. ..$ 5. volume: chr "45619558"
  ..$ 2024-08-08:List of 5
  .. ..$ 1. open  : chr "523.9100"
  .. ..$ 2. high  : chr "531.2900"
  .. ..$ 3. low   : chr "521.8400"
  .. ..$ 4. close : chr "530.6500"
  .. ..$ 5. volume: chr "63276589"
  ..$ 2024-08-07:List of 5
  .. ..$ 1. open  : chr "528.4700"
  .. ..$ 2. high  : chr "531.5900"
  .. ..$ 3. low   : chr "518.0519"
  .. ..$ 4. close : chr "518.6600"
  .. ..$ 5. volume: chr "70698340"
  ..$ 2024-08-06:List of 5
  .. ..$ 1. open  : chr "519.2200"
  .. ..$ 2. high  : chr "529.7500"
  .. ..$ 3. low   : chr "517.8700"
  .. ..$ 4. close : chr "522.1500"
  .. ..$ 5. volume: chr "84826312"
  ..$ 2024-08-05:List of 5
  .. ..$ 1. open  : chr "511.6400"
  .. ..$ 2. high  : chr "523.5800"
  .. ..$ 3. low   : chr "510.2700"
  .. ..$ 4. close : chr "517.3800"
  .. ..$ 5. volume: chr "146267391"
  ..$ 2024-08-02:List of 5
  .. ..$ 1. open  : chr "535.7500"
  .. ..$ 2. high  : chr "536.9900"
  .. ..$ 3. low   : chr "528.6000"
  .. ..$ 4. close : chr "532.9000"
  .. ..$ 5. volume: chr "82789070"
  ..$ 2024-08-01:List of 5
  .. ..$ 1. open  : chr "552.5700"
  .. ..$ 2. high  : chr "554.8688"
  .. ..$ 3. low   : chr "539.4300"
  .. ..$ 4. close : chr "543.0100"
  .. ..$ 5. volume: chr "76428732"
  ..$ 2024-07-31:List of 5
  .. ..$ 1. open  : chr "548.9800"
  .. ..$ 2. high  : chr "553.5000"
  .. ..$ 3. low   : chr "547.5799"
  .. ..$ 4. close : chr "550.8100"
  .. ..$ 5. volume: chr "65663388"
  ..$ 2024-07-30:List of 5
  .. ..$ 1. open  : chr "546.2600"
  .. ..$ 2. high  : chr "547.3400"
  .. ..$ 3. low   : chr "538.5150"
  .. ..$ 4. close : chr "542.0000"
  .. ..$ 5. volume: chr "46853632"
  ..$ 2024-07-29:List of 5
  .. ..$ 1. open  : chr "546.0200"
  .. ..$ 2. high  : chr "547.0500"
  .. ..$ 3. low   : chr "542.7200"
  .. ..$ 4. close : chr "544.7600"
  .. ..$ 5. volume: chr "39515824"
  ..$ 2024-07-26:List of 5
  .. ..$ 1. open  : chr "542.2800"
  .. ..$ 2. high  : chr "547.1900"
  .. ..$ 3. low   : chr "541.4900"
  .. ..$ 4. close : chr "544.4400"
  .. ..$ 5. volume: chr "53763788"
  ..$ 2024-07-25:List of 5
  .. ..$ 1. open  : chr "541.3500"
  .. ..$ 2. high  : chr "547.4550"
  .. ..$ 3. low   : chr "537.4500"
  .. ..$ 4. close : chr "538.4100"
  .. ..$ 5. volume: chr "61158288"
  ..$ 2024-07-24:List of 5
  .. ..$ 1. open  : chr "548.8600"
  .. ..$ 2. high  : chr "549.1700"
  .. ..$ 3. low   : chr "540.2900"
  .. ..$ 4. close : chr "541.2300"
  .. ..$ 5. volume: chr "74515266"
  ..$ 2024-07-23:List of 5
  .. ..$ 1. open  : chr "554.5400"
  .. ..$ 2. high  : chr "556.7350"
  .. ..$ 3. low   : chr "553.2750"
  .. ..$ 4. close : chr "553.7800"
  .. ..$ 5. volume: chr "34439561"
  .. [list output truncated]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ forcats   1.0.0     ✔ purrr     1.0.2
✔ ggplot2   3.5.1     ✔ readr     2.1.5
✔ lubridate 1.9.3     ✔ stringr   1.5.1
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and parse the "Time Series (Daily)" data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>sp500_data_clean <span class="ot">&lt;-</span> sp500_data[[<span class="st">"Time Series (Daily)"</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"Date"</span>, <span class="at">value =</span> <span class="st">"Metrics"</span>) <span class="sc">%&gt;%</span> <span class="co"># Convert list to tibble</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(Metrics) <span class="sc">%&gt;%</span> <span class="co"># Flatten the nested list in "Metrics"</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Date =</span> <span class="fu">as.Date</span>(Date), <span class="co"># Convert date to Date format</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">1. open</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">1. open</span><span class="st">`</span>),</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">2. high</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">2. high</span><span class="st">`</span>),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">3. low</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">3. low</span><span class="st">`</span>),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">4. close</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">4. close</span><span class="st">`</span>),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">5. volume</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">5. volume</span><span class="st">`</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the cleaned data</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sp500_data_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  Date       `1. open` `2. high` `3. low` `4. close` `5. volume`
  &lt;date&gt;         &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;
1 2024-12-10      605.      606.     602.       603.    37234515
2 2024-12-09      608.      608.     604.       605.    34742738
3 2024-12-06      607.      609.     607.       608.    31241549
4 2024-12-05      608.      608.     606.       607.    28762183
5 2024-12-04      606.      608.     605.       608.    42787561
6 2024-12-03      603.      604.     602.       604.    26906629</code></pre>
</div>
</div>
</section>
<section id="fred-example-get-economic-indicator-data" class="level3">
<h3 class="anchored" data-anchor-id="fred-example-get-economic-indicator-data">FRED Example: Get economic indicator data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fred_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>fred_params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">"GDP"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">api_key =</span> fred_key,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_type =</span> <span class="st">"json"</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>fred_response <span class="ot">&lt;-</span> <span class="fu">GET</span>(fred_url, <span class="at">query =</span> fred_params)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>fred_data <span class="ot">&lt;-</span> <span class="fu">content</span>(fred_response, <span class="at">as =</span> <span class="st">"parsed"</span>, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Limit to most recent 1 year (365 days) to reduce data points</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>sp500_data_clean <span class="ot">&lt;-</span> sp500_data_clean <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="fu">max</span>(Date)) <span class="sc">-</span> <span class="dv">365</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Precompute and downsample moving averages to reduce computation</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>sp500_data_clean <span class="ot">&lt;-</span> sp500_data_clean <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ma_30 =</span> zoo<span class="sc">::</span><span class="fu">rollapply</span>(<span class="st">`</span><span class="at">4. close</span><span class="st">`</span>, <span class="at">width =</span> <span class="dv">30</span>, <span class="at">FUN =</span> mean, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ma_90 =</span> zoo<span class="sc">::</span><span class="fu">rollapply</span>(<span class="st">`</span><span class="at">4. close</span><span class="st">`</span>, <span class="at">width =</span> <span class="dv">90</span>, <span class="at">FUN =</span> mean, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Downsample data (keep every 5th row for faster plotting)</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">n</span>(), <span class="at">by =</span> <span class="dv">5</span>))</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Closing Prices with Moving Averages</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sp500_data_clean, <span class="fu">aes</span>(<span class="at">x =</span> Date)) <span class="sc">+</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">4. close</span><span class="st">`</span>, <span class="at">color =</span> <span class="st">"Closing Price"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ma_30, <span class="at">color =</span> <span class="st">"30-Day Moving Avg"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ma_90, <span class="at">color =</span> <span class="st">"90-Day Moving Avg"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"S&amp;P 500 Closing Prices with Moving Averages"</span>,</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Price ($)"</span>,</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Legend"</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 18 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse FRED Data</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>gdp_data <span class="ot">&lt;-</span> fred_data[[<span class="st">"observations"</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),             <span class="co"># Convert 'date' column to Date format</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> value         <span class="co"># Convert 'value' column to numeric (invalid values become NA)</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="visualizations" class="level2">
<h2 class="anchored" data-anchor-id="visualizations">Visualizations</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sp500_data_clean, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> <span class="st">`</span><span class="at">4. close</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"S&amp;P 500 Closing Prices"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Closing Price ($)"</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<pre><code></code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(fred_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 13
 $ realtime_start   : chr "2024-11-30"
 $ realtime_end     : chr "2024-11-30"
 $ observation_start: chr "1600-01-01"
 $ observation_end  : chr "9999-12-31"
 $ units            : chr "lin"
 $ output_type      : int 1
 $ file_type        : chr "json"
 $ order_by         : chr "observation_date"
 $ sort_order       : chr "asc"
 $ count            : int 315
 $ offset           : int 0
 $ limit            : int 100000
 $ observations     :'data.frame':  315 obs. of  4 variables:
  ..$ realtime_start: chr [1:315] "2024-11-30" "2024-11-30" "2024-11-30" "2024-11-30" ...
  ..$ realtime_end  : chr [1:315] "2024-11-30" "2024-11-30" "2024-11-30" "2024-11-30" ...
  ..$ date          : chr [1:315] "1946-01-01" "1946-04-01" "1946-07-01" "1946-10-01" ...
  ..$ value         : chr [1:315] "." "." "." "." ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and clean the observations</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>gdp_data_clean <span class="ot">&lt;-</span> fred_data<span class="sc">$</span>observations <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),           <span class="co"># Convert date to Date format</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">as.numeric</span>(value)       <span class="co"># Convert value to numeric, invalid entries become NA</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value))             <span class="co"># Remove rows with NA in the value column</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `value = as.numeric(value)`.
Caused by warning:
! NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the cleaned data</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gdp_data_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  realtime_start realtime_end       date   value
1     2024-11-30   2024-11-30 1947-01-01 243.164
2     2024-11-30   2024-11-30 1947-04-01 245.968
3     2024-11-30   2024-11-30 1947-07-01 249.585
4     2024-11-30   2024-11-30 1947-10-01 259.745
5     2024-11-30   2024-11-30 1948-01-01 265.742
6     2024-11-30   2024-11-30 1948-04-01 272.567</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gdp_data_clean, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GDP Over Time"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"GDP (Billions of Dollars)"</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gdp_data_clean, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GDP Trend Over Time"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"GDP (Billions of Dollars)"</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>gdp_yoy <span class="ot">&lt;-</span> gdp_data_clean <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> <span class="co"># Extract year from date</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_gdp =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">yoy_growth =</span> (avg_gdp <span class="sc">-</span> <span class="fu">lag</span>(avg_gdp)) <span class="sc">/</span> <span class="fu">lag</span>(avg_gdp) <span class="sc">*</span> <span class="dv">100</span> <span class="co"># YoY growth</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the YoY Growth Data</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gdp_yoy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
   year avg_gdp yoy_growth
  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
1  1947    250.     NA    
2  1948    274.      9.96 
3  1949    272.     -0.726
4  1950    300.     10.0  
5  1951    347.     15.7  
6  1952    367.      5.89 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gdp_yoy, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> yoy_growth)) <span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Year-over-Year GDP Growth"</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"YoY Growth (%)"</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_col()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>wage_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">c</span>(<span class="st">"2001-01-01"</span>, <span class="st">"2001-04-01"</span>, <span class="st">"2001-07-01"</span>, <span class="st">"2001-10-01"</span>, <span class="st">"2002-01-01"</span>, <span class="st">"2002-04-01"</span>),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="st">"87.6"</span>, <span class="st">"88.4"</span>, <span class="st">"89.2"</span>, <span class="st">"90.0"</span>, <span class="st">"90.7"</span>, <span class="st">"91.6"</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process wage growth data</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>wage_df <span class="ot">&lt;-</span> wage_data <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, value) <span class="sc">%&gt;%</span>  <span class="co"># Select only the relevant columns</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">==</span> <span class="st">"."</span>, <span class="cn">NA</span>, <span class="fu">as.numeric</span>(value)),  <span class="co"># Replace "." with NA and convert to numeric</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date)  <span class="co"># Ensure date is in Date format</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(value)  <span class="co"># Remove rows where value is NA</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first few rows to confirm</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wage_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        date value
1 2001-01-01  87.6
2 2001-04-01  88.4
3 2001-07-01  89.2
4 2001-10-01  90.0
5 2002-01-01  90.7
6 2002-04-01  91.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolate data to monthly frequency if needed</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>wage_df_monthly <span class="ot">&lt;-</span> wage_df <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">date =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(date), <span class="fu">max</span>(date), <span class="at">by =</span> <span class="st">"month"</span>)) <span class="sc">%&gt;%</span>  <span class="co"># Fill missing months</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(value, <span class="at">.direction =</span> <span class="st">"down"</span>)  <span class="co"># Fill missing values by carrying forward</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the wage growth data</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wage_df_monthly, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Wage Growth Over Time"</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Wage Index Value"</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="alphavantage-fetch-u.s.-equities-data" class="level3">
<h3 class="anchored" data-anchor-id="alphavantage-fetch-u.s.-equities-data">AlphaVantage: Fetch U.S. Equities Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example for fetching S&amp;P 500 monthly adjusted close prices</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>alpha_url <span class="ot">&lt;-</span> <span class="st">"https://www.alphavantage.co/query"</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_MONTHLY_ADJUSTED"</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">symbol =</span> <span class="st">"SPY"</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">apikey =</span> alpha_key</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(alpha_url, <span class="at">query =</span> params)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the content</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>alpha_data <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">content</span>(response, <span class="at">as =</span> <span class="st">"parsed"</span>, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and process data</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>monthly_data <span class="ot">&lt;-</span> alpha_data[[<span class="st">"Monthly Adjusted Time Series"</span>]]</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>us_equity_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(monthly_data)),</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">adjusted_close =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(monthly_data, <span class="cf">function</span>(x) x[[<span class="st">"5. adjusted close"</span>]]))</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first few rows to confirm</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(us_equity_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        date adjusted_close
1 2024-12-10       602.8000
2 2024-11-29       602.5500
3 2024-10-31       568.6400
4 2024-09-30       573.7600
5 2024-08-30       561.9538
6 2024-07-31       549.1232</code></pre>
</div>
</div>
</section>
<section id="visualizing-the-sp-500-adjusted-close-prices" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-sp-500-adjusted-close-prices">Visualizing the S&amp;P 500 Adjusted Close Prices</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the S&amp;P 500 adjusted close prices</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(us_equity_df, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> adjusted_close)) <span class="sc">+</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"S&amp;P 500 Monthly Adjusted Close Prices"</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Adjusted Close Price"</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>us_equity_df <span class="ot">&lt;-</span> us_equity_df <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span>  <span class="co"># Ensure data is sorted by date</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_return =</span> adjusted_close <span class="sc">/</span> <span class="fu">lag</span>(adjusted_close) <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># Calculate monthly returns</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first few rows to confirm</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(us_equity_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        date adjusted_close monthly_return
1 1999-12-31        93.8436             NA
2 2000-01-31        89.1714    -0.04978709
3 2000-02-29        87.8136    -0.01522686
4 2000-03-31        96.3223     0.09689501
5 2000-04-28        92.9394    -0.03512063
6 2000-05-31        91.4782    -0.01572207</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>us_equity_df <span class="ot">&lt;-</span> us_equity_df <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(monthly_return)  <span class="co"># Remove rows with NA in the 'monthly_return' column</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first few rows to confirm</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(us_equity_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        date adjusted_close monthly_return
1 2000-01-31        89.1714    -0.04978709
2 2000-02-29        87.8136    -0.01522686
3 2000-03-31        96.3223     0.09689501
4 2000-04-28        92.9394    -0.03512063
5 2000-05-31        91.4782    -0.01572207
6 2000-06-30        93.2807     0.01970415</code></pre>
</div>
</div>
<p>Visualize Monthly Returns</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monthly returns over time</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(us_equity_df, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> monthly_return)) <span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"S&amp;P 500 Monthly Returns"</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Monthly Return"</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Statistical Summary of Returns</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics for monthly returns</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> us_equity_df <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_return =</span> <span class="fu">mean</span>(monthly_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_return =</span> <span class="fu">sd</span>(monthly_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_return =</span> <span class="fu">min</span>(monthly_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_return =</span> <span class="fu">max</span>(monthly_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summary statistics</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mean_return  sd_return min_return max_return
1 0.007198234 0.04411053 -0.1651874  0.1269836</code></pre>
</div>
</div>
</section>
</section>
<section id="monte-carlo-stimulation" class="level2">
<h2 class="anchored" data-anchor-id="monte-carlo-stimulation">Monte Carlo Stimulation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Monte Carlo Simulation of Monthly Returns</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># For reproducibility</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="dv">1000</span>  <span class="co"># Number of simulations</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>n_months <span class="ot">&lt;-</span> <span class="dv">12</span>  <span class="co"># Number of months</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>simulated_returns <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(n_sim <span class="sc">*</span> n_months, <span class="at">mean =</span> summary_stats<span class="sc">$</span>mean_return, <span class="at">sd =</span> summary_stats<span class="sc">$</span>sd_return),</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> n_sim</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to cumulative return paths</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>simulated_cum_returns <span class="ot">&lt;-</span> <span class="fu">apply</span>(simulated_returns, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> x) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a data frame for plotting</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>simulated_cum_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">month =</span> <span class="dv">1</span><span class="sc">:</span>n_months, simulated_cum_returns) <span class="sc">%&gt;%</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>month, <span class="at">names_to =</span> <span class="st">"simulation"</span>, <span class="at">values_to =</span> <span class="st">"cumulative_return"</span>)</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the Monte Carlo simulation results</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(simulated_cum_df, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> cumulative_return, <span class="at">group =</span> simulation)) <span class="sc">+</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monte Carlo Simulations of S&amp;P 500 Monthly Returns"</span>,</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative Return"</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="summary-statistics-for-the-simulations" class="level3">
<h3 class="anchored" data-anchor-id="summary-statistics-for-the-simulations">Summary Statistics for the Simulations</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate summary statistics at the final month</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>final_month_stats <span class="ot">&lt;-</span> simulated_cum_df <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> n_months) <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_return =</span> <span class="fu">mean</span>(cumulative_return),</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_return =</span> <span class="fu">median</span>(cumulative_return),</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_return =</span> <span class="fu">sd</span>(cumulative_return),</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_return =</span> <span class="fu">min</span>(cumulative_return),</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_return =</span> <span class="fu">max</span>(cumulative_return),</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob_positive =</span> <span class="fu">mean</span>(cumulative_return <span class="sc">&gt;</span> <span class="dv">0</span>)  <span class="co"># Probability of positive returns</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summary statistics</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_month_stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  mean_return median_return sd_return min_return max_return prob_positive
        &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;
1      0.0905        0.0817     0.160     -0.312      0.668         0.703</code></pre>
</div>
</div>
</section>
<section id="overlay-key-metrics-on-the-plot" class="level3">
<h3 class="anchored" data-anchor-id="overlay-key-metrics-on-the-plot">Overlay Key Metrics on the Plot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>summary_lines <span class="ot">&lt;-</span> simulated_cum_df <span class="sc">%&gt;%</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_cumulative =</span> <span class="fu">mean</span>(cumulative_return),</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_cumulative =</span> <span class="fu">median</span>(cumulative_return)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(mean_cumulative, median_cumulative),</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Statistic"</span>,</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"cumulative_return"</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add mean and median lines to the plot with a legend</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> simulated_cum_df, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> cumulative_return, <span class="at">group =</span> simulation),</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> summary_lines, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> cumulative_return, <span class="at">color =</span> Statistic),</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monte Carlo Simulations of S&amp;P 500 Monthly Returns"</span>,</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative Return"</span>,</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Key Metrics"</span></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"mean_cumulative"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"median_cumulative"</span> <span class="ot">=</span> <span class="st">"green"</span>),</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Mean"</span>, <span class="st">"Median"</span>)</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-1-combine-wage-growth-and-simulated-returns" class="level3">
<h3 class="anchored" data-anchor-id="step-1-combine-wage-growth-and-simulated-returns">Step 1: Combine Wage Growth and Simulated Returns</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure columns are in Date format</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>wage_df_aligned <span class="ot">&lt;-</span> wage_df_monthly <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">min</span>(simulated_cum_df<span class="sc">$</span>month) <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="fu">max</span>(simulated_cum_df<span class="sc">$</span>month)) <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))  <span class="co"># Ensure 'date' is in Date format</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>simulated_cum_df <span class="ot">&lt;-</span> simulated_cum_df <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">as.Date</span>(month))  <span class="co"># Ensure 'month' is in Date format</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Debugging filter outputs</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(wage_df_aligned))  <span class="co"># Check aligned wage data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 2
# ℹ 2 variables: date &lt;date&gt;, value &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">filter</span>(simulated_cum_df, month <span class="sc">==</span> <span class="fu">max</span>(simulated_cum_df<span class="sc">$</span>month)))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 3
   month      simulation cumulative_return
   &lt;date&gt;     &lt;chr&gt;                  &lt;dbl&gt;
 1 1970-01-13 X1                   0.196  
 2 1970-01-13 X2                  -0.0354 
 3 1970-01-13 X3                   0.189  
 4 1970-01-13 X4                   0.0339 
 5 1970-01-13 X5                   0.229  
 6 1970-01-13 X6                   0.00409
 7 1970-01-13 X7                   0.0765 
 8 1970-01-13 X8                   0.312  
 9 1970-01-13 X9                  -0.0157 
10 1970-01-13 X10                 -0.0378 
# ℹ 990 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Align dates to the first day of the month</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>wage_df_aligned <span class="ot">&lt;-</span> wage_df_aligned <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">floor_date</span>(date, <span class="at">unit =</span> <span class="st">"month"</span>))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>simulated_cum_df <span class="ot">&lt;-</span> simulated_cum_df <span class="sc">%&gt;%</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">floor_date</span>(month, <span class="at">unit =</span> <span class="st">"month"</span>))</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(wage_df_aligned))  <span class="co"># Check aligned wage data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 2
# ℹ 2 variables: date &lt;date&gt;, value &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">filter</span>(simulated_cum_df, month <span class="sc">==</span> <span class="fu">max</span>(simulated_cum_df<span class="sc">$</span>month)))  <span class="co"># Check filtered simulations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12,000 × 3
   month      simulation cumulative_return
   &lt;date&gt;     &lt;chr&gt;                  &lt;dbl&gt;
 1 1970-01-01 X1                  -0.0175 
 2 1970-01-01 X2                   0.0249 
 3 1970-01-01 X3                  -0.0204 
 4 1970-01-01 X4                   0.0316 
 5 1970-01-01 X5                   0.0416 
 6 1970-01-01 X6                   0.0239 
 7 1970-01-01 X7                   0.0516 
 8 1970-01-01 X8                  -0.00253
 9 1970-01-01 X9                   0.104  
10 1970-01-01 X10                 -0.00957
# ℹ 11,990 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regenerate simulation data to align with wage_df_monthly</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="dv">1000</span>  <span class="co"># Number of simulations</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>n_months <span class="ot">&lt;-</span> <span class="fu">nrow</span>(wage_df_monthly)  <span class="co"># Match the number of months in wage_df_monthly</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>simulated_cum_returns <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(n_sim <span class="sc">*</span> n_months, <span class="at">mean =</span> <span class="fl">0.007</span>, <span class="at">sd =</span> <span class="fl">0.04</span>),  <span class="co"># Use realistic mean and SD</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> n_sim</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with simulated cumulative returns</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>simulated_cum_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">month =</span> <span class="fu">rep</span>(wage_df_monthly<span class="sc">$</span>date, <span class="at">each =</span> n_sim),</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">simulation =</span> <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"X"</span>, <span class="dv">1</span><span class="sc">:</span>n_sim), <span class="at">times =</span> n_months),</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cumulative_return =</span> <span class="fu">as.vector</span>(simulated_cum_returns)</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge wage growth data with cumulative returns</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  wage_df_monthly,</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  simulated_cum_df <span class="sc">%&gt;%</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">simulation_id =</span> simulation),</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.x =</span> <span class="st">"date"</span>,</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.y =</span> <span class="st">"month"</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect combined data</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(combined_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        date value simulation_id cumulative_return
1 2001-01-01  87.6            X1      0.0009748016
2 2001-01-01  87.6            X2      0.0390376223
3 2001-01-01  87.6            X3     -0.0404687139
4 2001-01-01  87.6            X4      0.0242254545
5 2001-01-01  87.6            X5      0.0156698838
6 2001-01-01  87.6            X6      0.0454516938</code></pre>
</div>
</div>
</section>
<section id="calculate-contributions-and-portfolio-growth" class="level3">
<h3 class="anchored" data-anchor-id="calculate-contributions-and-portfolio-growth">Calculate Contributions and Portfolio Growth</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters for simulation</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>contribution_rate <span class="ot">&lt;-</span> <span class="fl">0.1</span>  <span class="co"># 10% of salary</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>starting_salary <span class="ot">&lt;-</span> <span class="dv">50000</span>  <span class="co"># Example starting salary in dollars</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate contributions and portfolio value</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_salary =</span> starting_salary <span class="sc">*</span> (value <span class="sc">/</span> <span class="fu">first</span>(value)),  <span class="co"># Adjust salary based on wage growth</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">contribution =</span> monthly_salary <span class="sc">*</span> contribution_rate,  <span class="co"># Monthly contributions</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">portfolio_value =</span> contribution <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> cumulative_return)  <span class="co"># Portfolio value after investment growth</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the portfolio growth for each simulation</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>portfolio_summary <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(simulation_id) <span class="sc">%&gt;%</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_portfolio_value =</span> <span class="fu">sum</span>(portfolio_value)</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the summary</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(portfolio_summary))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  simulation_id final_portfolio_value
  &lt;chr&gt;                         &lt;dbl&gt;
1 X1                           80529.
2 X10                          82803.
3 X100                         82632.
4 X1000                        81777.
5 X101                         81882.
6 X102                         83201.</code></pre>
</div>
</div>
</section>
<section id="visualize-portfolio-value-distribution" class="level3">
<h3 class="anchored" data-anchor-id="visualize-portfolio-value-distribution">Visualize Portfolio Value Distribution</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution of final portfolio values</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(portfolio_summary, <span class="fu">aes</span>(<span class="at">x =</span> final_portfolio_value)) <span class="sc">+</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10000</span>, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Final Portfolio Values"</span>,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Portfolio Value ($)"</span>,</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frequency"</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="calculate-probability-of-achieving-financial-goals" class="level3">
<h3 class="anchored" data-anchor-id="calculate-probability-of-achieving-financial-goals">Calculate Probability of Achieving Financial Goals</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of achieving a $1M goal</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>goal <span class="ot">&lt;-</span> <span class="dv">1000000</span>  <span class="co"># $1M goal</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>probability_of_success <span class="ot">&lt;-</span> <span class="fu">mean</span>(portfolio_summary<span class="sc">$</span>final_portfolio_value <span class="sc">&gt;=</span> goal)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the result</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Probability of achieving a portfolio value of $1M: "</span>, </span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(probability_of_success <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Probability of achieving a portfolio value of $1M:  0 %"</code></pre>
</div>
</div>
</section>
<section id="further-enhancements" class="level3">
<h3 class="anchored" data-anchor-id="further-enhancements">Further Enhancements</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_salary =</span> starting_salary <span class="sc">*</span> (value <span class="sc">/</span> <span class="fu">first</span>(value)) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> cumulative_return),</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">contribution =</span> monthly_salary <span class="sc">*</span> (contribution_rate <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.01</span>))  <span class="co"># Add random variability</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>portfolio_summary <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(simulation_id) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_portfolio_value =</span> <span class="fu">sum</span>(portfolio_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>withdrawal_rate <span class="ot">&lt;-</span> <span class="fl">0.04</span>  <span class="co"># 4% annual withdrawal rate</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>portfolio_summary <span class="ot">&lt;-</span> portfolio_summary <span class="sc">%&gt;%</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">retirement_portfolio =</span> final_portfolio_value <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> withdrawal_rate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualize-post-retirement-portfolio" class="level3">
<h3 class="anchored" data-anchor-id="visualize-post-retirement-portfolio">Visualize Post-Retirement Portfolio</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution of retirement portfolio values</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(portfolio_summary, <span class="fu">aes</span>(<span class="at">x =</span> retirement_portfolio)) <span class="sc">+</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10000</span>, <span class="at">fill =</span> <span class="st">"green"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Post-Retirement Portfolio Values"</span>,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Retirement Portfolio Value ($)"</span>,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frequency"</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bootstrap-sampling" class="level3">
<h3 class="anchored" data-anchor-id="bootstrap-sampling">Bootstrap Sampling</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of bootstrap simulations</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>n_bootstrap <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># While Working: Bootstrap Wage Growth</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>working_histories <span class="ot">&lt;-</span> <span class="fu">replicate</span>(</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  n_bootstrap,</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(combined_data<span class="sc">$</span>value, <span class="at">size =</span> <span class="fu">nrow</span>(combined_data), <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="co"># While Retired: Bootstrap Investment Returns</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>retired_histories <span class="ot">&lt;-</span> <span class="fu">replicate</span>(</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>  n_bootstrap,</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(simulated_cum_df<span class="sc">$</span>cumulative_return, <span class="at">size =</span> <span class="fu">nrow</span>(simulated_cum_df), <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculation" class="level3">
<h3 class="anchored" data-anchor-id="calculation">Calculation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define withdrawal rate</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>withdrawal_rate <span class="ot">&lt;-</span> <span class="fl">0.04</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate bootstrap histories</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>bootstrap_results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_len</span>(n_bootstrap), <span class="cf">function</span>(i) {</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate while working</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  wage_growth <span class="ot">&lt;-</span> working_histories[[i]]</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  cumulative_contributions <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(starting_salary <span class="sc">*</span> contribution_rate <span class="sc">*</span> wage_growth <span class="sc">/</span> <span class="fu">first</span>(wage_growth))</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate while retired</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  returns <span class="ot">&lt;-</span> retired_histories[[i]]</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  retirement_portfolio <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(returns))</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  retirement_portfolio[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">tail</span>(cumulative_contributions, <span class="dv">1</span>)  <span class="co"># Starting portfolio value</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(returns)) {</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>    retirement_portfolio[t] <span class="ot">&lt;-</span> retirement_portfolio[t <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> returns[t]) <span class="sc">-</span> (retirement_portfolio[t <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> withdrawal_rate)</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (retirement_portfolio[t] <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>      retirement_portfolio[t] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Ensure portfolio doesn't go negative</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return results</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">working =</span> cumulative_contributions,</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">retired =</span> retirement_portfolio</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analysis" class="level3">
<h3 class="anchored" data-anchor-id="analysis">Analysis</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze bootstrap results</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>bootstrap_analysis <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(bootstrap_results, <span class="cf">function</span>(res) {</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_contribution =</span> <span class="fu">max</span>(res<span class="sc">$</span>working),</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_portfolio =</span> <span class="fu">max</span>(res<span class="sc">$</span>retired, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">exhausted =</span> <span class="fu">any</span>(res<span class="sc">$</span>retired <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of exhausting savings</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>prob_exhausted <span class="ot">&lt;-</span> <span class="fu">mean</span>(bootstrap_analysis<span class="sc">$</span>exhausted)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> bootstrap_analysis <span class="sc">%&gt;%</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_contribution =</span> <span class="fu">mean</span>(max_contribution),</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_portfolio =</span> <span class="fu">mean</span>(max_portfolio),</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob_exhausted =</span> <span class="fu">mean</span>(exhausted)</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mean_contribution mean_portfolio prob_exhausted
1          80108560       80861697              0</code></pre>
</div>
</div>
</section>
<section id="visualize-results" class="level3">
<h3 class="anchored" data-anchor-id="visualize-results">Visualize Results</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bootstrap_analysis, <span class="fu">aes</span>(<span class="at">x =</span> exhausted)) <span class="sc">+</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Probability of Portfolio Exhaustion"</span>, <span class="at">x =</span> <span class="st">"Exhausted Savings"</span>, <span class="at">y =</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bootstrap_analysis, <span class="fu">aes</span>(<span class="at">x =</span> max_portfolio)) <span class="sc">+</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10000</span>, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Retirement Portfolio Values"</span>, <span class="at">x =</span> <span class="st">"Portfolio Value ($)"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Based on the visualizations:</p>
<ol type="1">
<li><p><strong>Probability of Exhausting Savings</strong>:</p>
<ul>
<li>The first chart shows <strong>0 occurrences</strong> of exhausted savings (all <code>FALSE</code> for <code>exhausted</code>), suggesting that with the assumptions and bootstrap histories used, none of the retirement scenarios result in portfolio depletion.</li>
</ul></li>
<li><p><strong>Distribution of Portfolio Values</strong>:</p>
<ul>
<li><p>The second chart indicates some issue with the histogram visualization:</p>
<ul>
<li><p>The x-axis shows extremely high portfolio values (e.g., 1.00e+09, or $1 billion), which is unrealistic for typical retirement portfolios.</p></li>
<li><p>The histogram bars appear scattered, possibly due to incorrect scaling or extreme values in the data.</p></li>
</ul></li>
</ul></li>
</ol>
</section>
<section id="recommendations" class="level3">
<h3 class="anchored" data-anchor-id="recommendations"><strong>Recommendations</strong></h3>
<p>Based on the simulations, here are the recommendations:</p>
<section id="if-the-employee-prefers-stability" class="level4">
<h4 class="anchored" data-anchor-id="if-the-employee-prefers-stability"><strong>If the Employee Prefers Stability</strong>:</h4>
<p>The TRS plan is more suitable for employees who prioritize income stability during retirement. It provides:</p>
<ul>
<li><p>Predictable monthly payments.</p></li>
<li><p>Protection against market volatility.</p></li>
</ul>
</section>
<section id="if-the-employee-prefers-flexibility-and-growth-potential" class="level4">
<h4 class="anchored" data-anchor-id="if-the-employee-prefers-flexibility-and-growth-potential"><strong>If the Employee Prefers Flexibility and Growth Potential</strong>:</h4>
<p>The ORP plan offers greater flexibility and potentially higher returns. However, the employee must:</p>
<ul>
<li><p>Be comfortable with market risk.</p></li>
<li><p>Consider reducing withdrawal rates (e.g., 3% instead of 4%) to mitigate the risk of exhausting savings.</p></li>
</ul>
<hr>
</section>
</section>
<section id="considerations-for-the-employee" class="level3">
<h3 class="anchored" data-anchor-id="considerations-for-the-employee"><strong>Considerations for the Employee</strong></h3>
<ol type="1">
<li><p><strong>Age and Career Duration</strong>:</p>
<ul>
<li><p>Younger employees with longer career horizons may benefit from ORP’s growth potential.</p></li>
<li><p>Employees nearing retirement may prefer the stability of TRS.</p></li>
</ul></li>
<li><p><strong>Starting Salary</strong>:</p>
<ul>
<li><p>Higher salaries favor ORP for greater investment contributions.</p></li>
<li><p>Lower salaries may make TRS more attractive for guaranteed income.</p></li>
</ul></li>
<li><p><strong>Risk Tolerance</strong>:</p>
<ul>
<li><p>TRS suits risk-averse individuals.</p></li>
<li><p>ORP suits those willing to accept variability for potential upside.</p></li>
</ul></li>
<li><p><strong>Inflation and Long-Term Sustainability</strong>:</p>
<ul>
<li><p>TRS benefits may not keep pace with inflation over a long retirement.</p></li>
<li><p>ORP portfolios, if managed well, can outpace inflation but require discipline in withdrawals.</p></li>
</ul></li>
</ol>
<hr>
</section>
<section id="limitations-and-uncertainty" class="level3">
<h3 class="anchored" data-anchor-id="limitations-and-uncertainty"><strong>Limitations and Uncertainty</strong></h3>
<ol type="1">
<li><p><strong>Bootstrap Sampling</strong>:</p>
<ul>
<li><p>Historical data used in simulations may not reflect future economic conditions.</p></li>
<li><p>Bootstrap methods assume past trends are indicative of future outcomes.</p></li>
</ul></li>
<li><p><strong>Simplified Assumptions</strong>:</p>
<ul>
<li><p>Fixed withdrawal rates and contribution percentages may not reflect real-life variability.</p></li>
<li><p>Employee preferences and external factors (e.g., tax changes) were not modeled.</p></li>
</ul></li>
<li><p><strong>Market Risks</strong>:</p>
<ul>
<li>Simulations cannot predict black swan events (e.g., 2008 financial crisis).</li>
</ul></li>
</ol>
<hr>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion"><strong>Conclusion</strong></h3>
<p>The choice between TRS and ORP depends on the employee’s individual priorities and circumstances. For those seeking stability and simplicity, TRS is a safer option. For those aiming to maximize retirement wealth and are comfortable with risk, ORP can offer higher potential returns, provided they follow a disciplined withdrawal strategy.</p>
<p><strong>Final Recommendation</strong>: Align the decision with personal goals, risk tolerance, and financial needs. Regularly review and adjust the chosen plan as circumstances evolve.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/katariasiddhi\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>